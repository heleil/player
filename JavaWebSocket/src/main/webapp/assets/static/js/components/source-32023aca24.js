var sourcevue=new Vue({el:"#source",ready:function(){utils.getfav(this),this.getlist(),this.initselectdata()},data:{pagenum:1,listdata:"",downloaddata:"",playtracklist:"",favlist:""},computed:{babateng:function(){return"babateng"==DEBUG||"dev"==DEBUG},haspage:function(){return this.listdata.list.length<this.listdata.total}},methods:{initselectdata:function(){var t=this,e=utils.gettrackList();console.log(e),e.length&&$.each(e,function(t,e){e.title=e.name,e.value=e.id}),t.playtracklist=e},getlist:function(){var t=this,e={appId:window.juli.appRooboId,token:window.juli.appRooboToken,clientId:utils.getClientId(),albumId:utils.getparam("id"),queryAlbumInfo:!0,page:t.pagenum,count:utils.pagesize},a=juli.URL.cate+"?inter=/resources/list";$.ajax({url:a,type:"post",contentType:"application/json",data:JSON.stringify(e)}).done(function(e){if(JSON.parse(e).data){var a=JSON.parse(e).data;$.each(a.list,function(e,a){a.sec=utils.formatSeconds(a.length),a.isplay=!1,a.islike=!1,a.isexpand=!1,t.favlist.length&&t.favlist.forEach(function(t,e,i){a.resId.split("aires:")[1]==t.trackId&&(a.islike=!0)})}),t.listdata=a,utils.settitle(t.listdata.album.name)}})},getdetail:function(t){utils.getfav(this);var e=this;$.ajax({url:juli.URL.subcate+"/"+t.id+"/"+e.pagenum+"/"+utils.pagesize,type:"get",dataType:"json",cache:!1}).done(function(t){console.log(t);var a=JSON.parse(t).data;$.each(a.list,function(t,a){a.sec=utils.formatSeconds(a.length),a.isplay=!1,a.islike=!1,a.isexpand=!1,e.favlist.length&&e.favlist.forEach(function(t,e,i){a.resId.split("aires:")[1]==t.trackId&&(a.islike=!0)})}),e.listdata=a,history.pushState("","","#detail"),utils.settitle(e.listdata.album.name),window.onpopstate=function(){listdetailvm.pagenum=1,listdetailvm.getlist()}})},nextpage:function(){var t=this;t.pagenum=t.pagenum+1;var t=this,e={appId:window.juli.appRooboId,token:window.juli.appRooboToken,clientId:utils.getClientId(),albumId:utils.getparam("id"),queryAlbumInfo:!0,page:t.pagenum,count:utils.pagesize},a=juli.URL.cate+"?inter=/resources/list";$.ajax({url:a,type:"post",contentType:"application/json",data:JSON.stringify(e)}).done(function(e){console.log(e);var a=JSON.parse(e).data;$.each(a.list,function(e,a){a.sec=utils.formatSeconds(a.length),a.islike=!1,a.isexpand=!1,t.favlist.length&&t.favlist.forEach(function(t,e,i){a.resId.split("aires:")[1]==t.trackId&&(a.islike=!0)})}),$.each(a.list,function(e,a){a.isplay=!1,t.listdata.list.push(a)})})},toggleopen:function(t){console.log("start"),$.each(this.listdata.list,function(t,e){e.isexpand=!1}),t.isexpand=!t.isexpand},"try":function(t){$.each(this.listdata.list,function(t,e){e.isplay=!1});var e=document.getElementById("try");e.src=t.content,e.play(),t.isplay=!0,e.onended=function(){t.isplay=!1}},stoptry:function(t){var e=document.getElementById("try");e.pause(),t.isplay=!1},demand:function(t){utils.demand(t.resId.split("aires:")[1],t.content)},addfav:function(t){if(!utils.getdevice())return $.alert("您还没有绑定设备，请去绑定设备！","",function(){}),!1;var e={openId:utils.openid,trackId:t.resId.split("aires:")[1],title:t.name,duration:t.length,url:t.content,downloadUrl:t.content,downloadSize:t.playUrls.size};$.ajax({url:juli.URL.addlike,type:"post",contentType:"application/json",data:JSON.stringify(e)}).done(function(e){$.toast("已添加收藏","text"),t.islike=!0})},dellike:function(t){var e={trackId:t.resId.split("aires:")[1],openId:utils.openid};$.ajax({url:juli.URL.dellike,type:"post",cache:!1,async:!1,contentType:"application/json",data:JSON.stringify(e)}).done(function(e){console.log(e),$.toast("删除收藏","text"),t.islike=!1})},download:function(t){utils.clearselect();var e=this;if(!utils.getdevice())return $.alert("您还没有绑定设备，请去绑定设备！","",function(){}),!1;var a=[{title:t.name,id:t.resId.split("aires:")[1],duration:t.length,albumTitle:e.listdata.album.name,albumCoverSmallUrl:e.listdata.album.imgSmall,url:t.content,downloadUrl:t.playUrls.url,downloadSize:t.playUrls.size}];e.downloaddata=a,$("#select").select({title:"请选择播放列表",items:e.playtracklist,closeText:"取消",onChange:function(){e.downloadfun($("#select").val(),$("#select").data("values"))}}),$("#select").select("open")},downloadfun:function(t,e){var a=this;console.log(t),console.log(e),$.ajax({url:juli.URL.download+"?deviceId="+utils.getdevice()+"&id="+e+"&name="+encodeURI(encodeURI(t)),type:"post",async:!1,contentType:"application/json",data:JSON.stringify(a.downloaddata)}).done(function(t){console.log(t),$.toast("添加成功","text"),utils.clearselect()})},downloadlist:function(){utils.clearselectall();var t=this;return utils.getdevice()?($("#selectall").select({title:"请选择播放列表",items:t.playtracklist,closeText:"取消",onChange:function(){t.downloadlistfun($("#selectall").val(),$("#selectall").data("values"))}}),void $("#selectall").select("open")):($.alert("您还没有绑定设备，请去绑定设备！","",function(){}),!1)},downloadlistfun:function(t,e){var a=this;console.log(t),console.log(e);var i={deviceId:utils.getdevice(),id:e,name:t,list:a.listdata.list};$.ajax({url:juli.URL.downloadlist,type:"post",cache:!1,async:!1,contentType:"application/json",data:JSON.stringify(i)}).done(function(t){"ok"==t?($.toast("添加成功~","text"),utils.clearselectall()):"duplicate"==t?($.toast("已经添加过了哦~","text"),utils.clearselectall()):($.toast("添加失败~","text"),utils.clearselectall())})}}});