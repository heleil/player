function onConnect(){console.log("onConnect"),""!=window.deviceId&&client.subscribe("storybox/"+window.deviceId+"/client"),onConnectCallback&&onConnectCallback()}function onFailure(){var e=new Date;console.log(e+" failure,try to reclient"),clientConnect()}function onConnectionLost(){clientConnect()}function onMessageDelivered(e){alert("发送成功")}function clientCreate(e){if(WebSocketCheck())client.onMessageArrived=onMessageArrived,e=e,clientConnect();else{var t='<div class="alert alert-danger notSupportWebSocket"><span>抱歉，您的浏览器不支持某些重要特性，有些功能无法正常使用</span></div>';$("body").find("div").eq(0).before(t)}}function clientConnect(){try{client.connect({cleanSession:!1,useSSL:window.juli.useSSL,onSuccess:onConnect,onFailure:onFailure})}catch(e){console.log(e)}}function clientPublish(e){if(WebSocketCheck()){var t=JSON.stringify(e);if(console.log(t),""!=window.deviceId){var n=new Paho.MQTT.Message(t),o="storybox/"+window.deviceId+"/server/page";n.destinationName=o;try{console.log(),client.send(n)}catch(i){console.log(i)}}}}function WebSocketCheck(){return"WebSocket"in window}function onMessageArrived(e){console.log("onMessageArrived:"+e.payloadString);try{var t=JSON.parse(e.payloadString);console.log(t),t.hasOwnProperty("onlineStatus")?onlineStatus_change&&onlineStatus_change(t.onlineStatus):t.hasOwnProperty("boxInfo")?showBoxInfo&&showBoxInfo(t.boxInfo):t.hasOwnProperty("volume")?currentVolumeDisplay&&currentVolumeDisplay(t.volume):t.hasOwnProperty("trackListId")&&t.hasOwnProperty("trackId")&&t.hasOwnProperty("type")?playTrack_change&&playTrack_change(t.trackListId,t.trackId,t.type):t.hasOwnProperty("playStatus")?playStatus_change&&playStatus_change(t.playStatus):t.hasOwnProperty("playProgress")?currentProgressDisplay&&currentProgressDisplay(t.playProgress):t.hasOwnProperty("mode")?mode_change&&mode_change(t.mode):t.hasOwnProperty("downloadStatus")&&t.hasOwnProperty("trackId")?after_download&&after_download(t.downloadStatus,t.trackId):t.hasOwnProperty("configWifi")?onConfigWifi&&onConfigWifi(t.configWifi):t.hasOwnProperty("playSinVoiceUrl")&&t.hasOwnProperty("openId")?(console.log("------------------------------------"),playSinVoiceUrl&&playSinVoiceUrl(t.playSinVoiceUrl,t.openId)):t.hasOwnProperty("cmd")&&t.hasOwnProperty("trackListId")&&t.hasOwnProperty("trackIds")?"initialTrackList"==t.cmd&&startInitialTrackList&&(t.hasOwnProperty("from")&&t.hasOwnProperty("to")&&t.hasOwnProperty("listSize")?(0==t.from&&(initialList.listId=t.trackListId,initialList.trackIds=[]),initialList.listId==t.trackListId&&(initialList.trackIds.push.apply(initialList.trackIds,t.trackIds),t.to+1>=t.listSize&&(startInitialTrackList(t.trackListId,initialList.trackIds),initialList.listId=-1,initialList.trackIds=[]))):startInitialTrackList(t.trackListId,t.trackIds)):t.hasOwnProperty("cmd")&&"customer"==t.cmd&&t.hasOwnProperty("key")&&t.hasOwnProperty("value")&&("poweroff"==t.key?onCustomerPoweroff&&onCustomerPoweroff(t.value):"light"==t.key?onCustomerLight&&onCustomerLight(t.value):"childlock"==t.key?onCustomerChildlock&&onCustomerChildlock(t.value):"playProgress"==t.key&&onCustomerPlayProgress&&onCustomerPlayProgress(t.value))}catch(n){console.log(n)}}function playTrack(e,t,n,o){var i={cmd:"playTrack",trackListId:e,trackId:t,url:n,downloadUrl:o};clientPublish(i)}function forwardTrack(){var e={cmd:"forward"};clientPublish(e)}function backwardTrack(){var e={cmd:"backward"};clientPublish(e)}function pauseTrack(){var e={cmd:"pause"};clientPublish(e)}function resumeTrack(){var e={cmd:"resume"};clientPublish(e)}function queryTrack(){var e={cmd:"getTrack"};clientPublish(e)}function queryPlayStatus(){var e={cmd:"getPlayStatus"};clientPublish(e)}function queryPlayProgress(){var e={cmd:"getPlayProgress"};clientPublish(e)}function queryMode(){var e={cmd:"getMode"};clientPublish(e)}function setRepeatall(){var e={cmd:"setMode",value:"repeat all"};clientPublish(e)}function setRepeatone(){var e={cmd:"setMode",value:"repeat one"};clientPublish(e)}function cmd_poweroff(){var e={cmd:"setPoweroff"};clientPublish(e)}function cmd_setvolume(e){var t={cmd:"setVolume",value:e};clientPublish(t)}function cmd_getVolume(){var e={cmd:"getVolume"};clientPublish(e)}function getOnlineStatus(){var e={cmd:"getOnlineStatus"};clientPublish(e)}function getBoxInfo(){var e={cmd:"getBoxInfo"};clientPublish(e)}function boxUpgrade(e,t){var n={cmd:"upgrade",versionName:e,firmwareUrl:t};clientPublish(n)}function getInitialTrackList(e){e=parseInt(e);var t={cmd:"getInitialTrackList",trackListId:e};clientPublish(t)}function cmd_customer_getPoweroff(){var e={cmd:"customer",key:"getPoweroff"};clientPublish(e)}function cmd_customer_setPoweroff(e){var t={cmd:"customer",key:"setPoweroff",value:e};clientPublish(t)}function cmd_customer_getLight(){var e={cmd:"customer",key:"getLight"};clientPublish(e)}function cmd_customer_setLight(e){var t={cmd:"customer",key:"setLight",value:e};clientPublish(t)}function cmd_customer_getChildlock(){var e={cmd:"customer",key:"getChildlock"};clientPublish(e)}function cmd_customer_setChildlock(e){var t={cmd:"customer",key:"setChildlock",value:e};clientPublish(t)}function cmd_customer_getPlayProgress(){var e={cmd:"customer",key:"getPlayProgress"};clientPublish(e)}function cmd_customer_seekTrack(e){var t={cmd:"customer",key:"seek",value:e};clientPublish(t)}function playTracks(e,t){if(0==t){var n={cmd:"playTracks",trackIds:e};clientPublish(n)}else for(var o=0,i=0,r=new Array,c=0;c<e.length;c++){if(c%100==0){e.length-c>=100?100:e.length-c;r=new Array,o=c}i=c,r[c-o]=e[c];var a=e.length;if(c-o>=99||c==e.length-1){var n={cmd:"playTracks",from:o,to:i,listSize:a,trackIds:r};clientPublish(n)}}}var clientId=(new Date).getTime().toString(),client=new Paho.MQTT.Client(window.juli.MQTT,window.juli.MQTTPORT,clientId);client.onConnectionLost=onConnectionLost;var onConnectCallback,initialList={};