function onConnectCallback(){console.log("hahah，链接啦！"),queryTrack(),queryPlayStatus(),queryMode(),cmd_getVolume()}function playStatus_change(e){console.log(e),"playing"==e?listvm.isplay=!0:listvm.isplay=!1}function playTrack_change(e,t,i){listvm.tracklistid=e,t==-1?listvm.music=" ":listvm.getsingle(t)}function mode_change(e){var t=listvm;console.log(e),"repeat all"==e?(t.isloop=!0,$(".play-component").hasClass("play-show")&&$.toast("当前循环模式为:全部循环~","text")):(t.isloop=!1,$(".play-component").hasClass("play-show")&&$.toast("当前循环模式为:单曲循环~","text"))}function onlineStatus_change(e){return"on"!=e&&"online"!=e&&"on-upgrade-failed"!=e?(listvm.deviceOnline=!1,"zhiban"===DEBUG?$.toast("机器人断网了哦~","text"):$.toast("宝贝断网了哦~","text"),!1):(console.log("deviceOnline true"),void(listvm.deviceOnline=!0))}function currentVolumeDisplay(e){console.log("currentVolumeDisplay callback: "+e);var t=Math.round(e/40*100);listvm.getVolume(t),$sliderTrackVolume.css("width",t+"%"),$sliderHandlerVolume.css("left",t+"%")}function onCustomerPlayProgress(e){listvm.getProgress(e)}function initScroolReval(){console.log($(".animate-box"));var e={origin:"top",viewFactor:.15,duration:800,distance:"0px",scale:.5,easing:"ease",mobile:!0};window.sr=new ScrollReveal(e);var t={reset:!1,viewOffset:{bottom:100}};sr.reveal(".animate-box",t)}var listvm=new Vue({el:"html",data:{loading:!0,list:"",input:"",times:"",learning:"",newests:"",chinese:"",cnindexs:[],english:"",enindexs:[],recommendations:"",imghost:"http://dwn.roo.bo/appimg/",deviceOnline:!1,music:"",isplay:!1,isloop:!1,islike:!1,tracklistid:-1,currentdata:"",sec:"",favlist:"",audio:"0",progresspercent:0,progress:0,currentprogress:"00:00",interval:"",playerimg:"static/img/demo.jpg",scroolinit:0,volumeimg:!0},computed:{babateng:function(){return"babateng"==DEBUG||"dev"==DEBUG},mingxiao:function(){return"mingxiao_build"==DEBUG},orange:function(){return"orange"==DEBUG},zhiban:function(){return"zhiban"==DEBUG},yazai:function(){return"yazai"==DEBUG},title:function(){return this.babateng?"故事云":this.mingxiao?"云端内容":this.orange?"故事云":this.zhiban?"百宝袋":this.yazai?"早教":"儿童馆"},device_tips:function(){return this.deviceOnline?this.isplay?this.music:"设备已连接":"设备未连接"}},watch:{scroolinit:function(e){3==e&&initScroolReval()}},ready:function(){this.getdata(),this.isOnline(),this.getdeviceinfo()},methods:{getdata:function(){var e=this,t={appId:window.juli.appRooboId,token:window.juli.appRooboToken,clientId:utils.getClientId(),userId:"",tags:["six"]},i=juli.URL.cate+"?inter=/cms/modules";$.ajax({url:i,type:"post",contentType:"application/json",data:JSON.stringify(t)}).done(function(t){e.loading=!1,listvm.list=JSON.parse(t).data.modules;for(var i=0;i<listvm.list.length;i++)"banner广告"==listvm.list[i].name&&listvm.list.$remove(listvm.list[i]);e.getTimes(),e.getRecommendations()}),utils.settitle("智慧馆")},search:function(){console.log(this.input),location.href="search.html?search="+this.input},getTimes:function(){var e=this.list.length-4,t=1,i=e/4;for(this.times=[],e%4&&(this.times.push(t),t++,i++);t<=i;t++)this.times.push(t)},more:function(){$(".item-more").toggleClass("active"),$(".item-more").hasClass("active")?$(".item-more").find("h5").text("收回"):$(".item-more").find("h5").text("更多"),$(".top-category.more").stop(!0,!0),$(".top-category.more").toggle("fast")},getRandomNmber:function(e,t,i){for(var n=t,s=[],o=new Array,r=0;r<n;r++)o[r]=r+i;o.sort(function(){return.5-Math.random()});for(var r=0;r<e;r++)s.push(o[r]);return s},getRecommendations:function(){var e=this;e.recommendations=[];for(var t=[],i=0;i<listvm.list.length;i++)if("mod"==listvm.list[i].attr&&listvm.list[i].contents.length>0)for(var n=0;n<listvm.list[i].contents.length;n++)t.push(listvm.list[i].contents[n]);for(var s=e.getRandomNmber(12,t.length-1,0),o=0;o<12;o++)listvm.recommendations.push(t[s[o]]);e.scroolinit++},getdeviceinfo:function(){clientCreate(onConnectCallback)},isOnline:function(){var e=this;utils.online()?e.deviceOnline=!0:e.deviceOnline=!1},pause:function(){var e=this;return e.deviceOnline?(pauseTrack(),void(e.isplay=!1)):(utils.showOfflineToast(),!1)},resume:function(){var e=this;return e.deviceOnline?(resumeTrack(),void(e.isplay=!0)):(utils.showOfflineToast(),!1)},repeatone:function(){var e=this;return e.deviceOnline?(setRepeatone(),void(this.isloop=!1)):(utils.showOfflineToast(),!1)},repeatall:function(){var e=this;return e.deviceOnline?(setRepeatall(),void(this.isloop=!0)):(utils.showOfflineToast(),!1)},forward:function(){var e=this;return e.deviceOnline?void forwardTrack():(utils.showOfflineToast(),!1)},backward:function(){var e=this;return e.deviceOnline?void backwardTrack():(utils.showOfflineToast(),!1)},showlist:function(){var e=this;return e.deviceOnline?e.tracklistid==-1?($.toast("当前无播放列表","text"),!1):void(location.href="mylist.html?id="+e.tracklistid):(utils.showOfflineToast(),!1)},getsingle:function(e){var t=this;utils.getfav(this),$.ajax({url:juli.URL.singleview+"?trackId="+e,type:"get",dataType:"json",cache:!1}).done(function(e){console.log("getsingle"),console.log(e),e||$.alert("已经没有更多歌曲了哦~","",function(){return!1}),""!=this.interval&&(clearInterval(this.interval),this.interval=""),t.currentdata=e,t.music=t.currentdata.title,t.sec=t.formatSeconds(t.currentdata.duration),t.islike=!1,null!=t.currentdata.coverSmallUrl&&""!=t.currentdata.coverSmallUrl?playerimg=t.currentdata.coverSmallUrl:null!=t.currentdata.albumCoverSmallUrl&&""!=t.currentdata.albumCoverSmallUrl?playerimg=t.currentdata.albumCoverSmallUrl:playerimg="static/img/demo.jpg",cmd_customer_getPlayProgress(),t.favlist.forEach(function(i,n,s){e.id==i.trackId&&(t.islike=!0)})})},addfav:function(){if(!utils.getdevice())return $.alert("您还没有绑定设备，请去绑定设备！","",function(){}),!1;var e=this,t={openId:utils.openid,trackId:e.currentdata.id,title:e.currentdata.title,duration:e.currentdata.duration,url:e.currentdata.url,downloadUrl:e.currentdata.downloadUrl,downloadSize:e.currentdata.size};$.ajax({url:juli.URL.addlike,type:"post",contentType:"application/json",data:JSON.stringify(t)}).done(function(t){$.toast("已添加收藏","text"),e.islike=!0})},dellike:function(){var e=this,t={trackId:e.currentdata.id,openId:utils.openid};$.ajax({url:juli.URL.dellike,type:"post",cache:!1,async:!1,contentType:"application/json",data:JSON.stringify(t)}).done(function(t){console.log(t),$.toast("删除收藏","text"),e.islike=!1})},setVolume:function(){cmd_setvolume(Math.round(40*this.audio/100)),console.log("volume: "+Math.round(40*this.audio/100)+" percent: "+this.audio)},getVolume:function(e){this.audio=e,console.log("getVolume: "+this.audio)},getProgress:function(e){return e>=this.currentdata.duration&&(e=this.currentdata.duration),!(""!=this.interval&&Math.abs(e-this.progress)<=2)&&void("undefined"!=typeof this.currentdata.duration&&(this.progress=e,this.progresspercent=this.progress/this.currentdata.duration*100,this.currentprogress=this.formatSeconds(this.progress),console.log("getProgress: "+this.progress),$sliderTrack.css("width",this.progresspercent+"%"),$sliderHandler.css("left",this.progresspercent+"%"),""!=this.interval&&(clearInterval(this.interval),this.interval=""),this.interval=setInterval(this.progressIncrease,1e3)))},getProgressPercent:function(e){"undefined"!=typeof this.currentdata.duration&&(this.progresspercent=e,this.progress=this.progresspercent/100*this.currentdata.duration,this.currentprogress=this.formatSeconds(this.progress),console.log("getProgressPercent: "+this.progresspercent))},setProgress:function(){cmd_customer_seekTrack(Math.round(this.progress)),setTimeout(cmd_customer_getPlayProgress,1e3)},progressIncrease:function(){if(this.isplay){if(this.progress>=this.currentdata.duration||this.progresspercent>=100)return clearInterval(this.interval),this.interval="",!1;this.progress++,this.progresspercent=this.progress/this.currentdata.duration*100,this.currentprogress=this.formatSeconds(Math.floor(this.progress)),$sliderTrack.css("width",this.progresspercent+"%"),$sliderHandler.css("left",this.progresspercent+"%")}},formatSeconds:function(e){var t=parseInt(e),i=0,n=0;t>=60&&(i=parseInt(t/60),t=parseInt(t%60),i>=60&&(n=parseInt(i/60),i=parseInt(i%60)));var s="00:"+("0"+parseInt(t)).slice(-2);return i>0&&(s=("0"+parseInt(i)).slice(-2)+":"+("0"+parseInt(t)).slice(-2)),n>0&&(s=("0"+parseInt(n)).slice(-2)+":"+("0"+parseInt(i)).slice(-2)+":"+("0"+parseInt(t)).slice(-2)),s},volumeset:function(){var e=this;e.volumeimg=!this.volumeimg;var t=document.querySelector(".topvoice").style.display;"block"==t?document.querySelector(".topvoice").style.display="none":document.querySelector(".topvoice").style.display="block"}}});$(function(){$(".play-bar").click(function(){return listvm.deviceOnline?($(".play-component").show(0),void $(".play-component").addClass("play-show")):(utils.showOfflineToast(),!1)}),$("#play-component .close").click(function(){$(".play-component").removeClass("play-show")}),$(".search-bar-new input").on("click",function(){$(".play-component").hide(0)})});var $sliderTrack=$("#sliderTrack"),$sliderHandler=$("#sliderHandler"),totalLen=$("#sliderInner").width(),startLeft=0,startX=0;$("#sliderInner").on("click",function(e){totalLen=$("#sliderInner").width();var t=e.originalEvent.offsetX,i=parseInt(t/totalLen*100);$sliderTrack.css("width",i+"%"),$sliderHandler.css("left",i+"%"),listvm.getProgressPercent(i),listvm.setProgress()}),$sliderHandler.on("touchstart",function(e){console.log(e.originalEvent),totalLen=$("#sliderInner").width(),startLeft=parseInt($sliderHandler.css("left")),startX=e.originalEvent.changedTouches[0].clientX}).on("touchmove",function(e){var t,i=startLeft+e.originalEvent.changedTouches[0].clientX-startX;i=i<0?0:i>totalLen?totalLen:i,t=parseInt(i/totalLen*100),$sliderTrack.css("width",t+"%"),$sliderHandler.css("left",t+"%"),listvm.getProgressPercent(t),e.preventDefault()}).on("touchend",function(e){listvm.setProgress()});var $sliderTrackVolume=$("#sliderTrackVolume"),$sliderHandlerVolume=$("#sliderHandlerVolume"),totalLenVolume=$("#sliderInnerVolume").width(),startLeftVolume=0,startXVolume=0;$("#sliderInnerVolume").on("click",function(e){totalLenVolume=$("#sliderInnerVolume").width();var t=e.originalEvent.offsetX,i=parseInt(t/totalLenVolume*100);$sliderTrackVolume.css("width",i+"%"),$sliderHandlerVolume.css("left",i+"%"),listvm.getVolume(i),listvm.setVolume()}),$sliderTrackVolume.on("touchstart",function(e){console.log(e.originalEvent),totalLenVolume=$("#sliderInnerVolume").width(),startLeftVolume=parseInt($sliderHandlerVolume.css("left")),startXVolume=e.originalEvent.changedTouches[0].clientX}).on("touchmove",function(e){var t,i=startLeftVolume+e.originalEvent.changedTouches[0].clientX-startXVolume;i=i<0?0:i>totalLenVolume?totalLenVolume:i,t=parseInt(i/totalLenVolume*100),$sliderTrackVolume.css("width",t+"%"),$sliderHandlerVolume.css("left",t+"%"),listvm.getVolume(t),e.preventDefault()}).on("touchend",function(e){listvm.setVolume()}),$("#minvolume").on("click",function(e){$sliderTrackVolume.css("width","0%"),$sliderHandlerVolume.css("left","0%"),listvm.getVolume(0),listvm.setVolume()}),$("#maxvolume").on("click",function(e){$sliderTrackVolume.css("width","100%"),$sliderHandlerVolume.css("left","100%"),listvm.getVolume(100),listvm.setVolume()});var $midvoiceTrack=$("#midvoiceTrack"),$sliderimgHandler=$("#sliderimgHandler"),totalvoiceLen=$("#topvoiceInner").height(),startTop=0,startY=0;$("#topvoiceInner").on("click",function(e){totalvoiceLen=$("#topvoiceInner").height();var t=e.originalEvent.offsetY,i=parseInt(t/totalvoiceLen*100);$midvoiceTrack.css("height",i+"%"),$sliderimgHandler.css("top",i+"%"),listvm.getVolume(i),listvm.setVolume()}),$sliderHandler.on("touchstart",function(e){console.log(e.originalEvent),totalvioceLen=$("#topvoiceInner").height(),startLeft=parseInt($sliderimgHandler.css("top")),startY=e.originalEvent.changedTouches[0].clientY}).on("touchmove",function(e){var t,i=startTop+e.originalEvent.changedTouches[0].clientY-startY;i=i<0?0:i>totalvoiceLen?totalvoiceLen:i,t=parseInt(i/totalvoiceLen*100),$sliderTrack.css("height",t+"%"),$sliderHandler.css("top",t+"%"),listvm.getVolume(t),e.preventDefault()}).on("touchend",function(e){listvm.setVolume()});